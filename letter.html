<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>For Salna</title>

<!-- Block search engines and crawlers -->
<meta name="robots" content="noindex, nofollow, noarchive, nosnippet, noimageindex, nocache">
<meta name="googlebot" content="noindex, nofollow, noarchive, nosnippet, noimageindex">
<meta name="bingbot" content="noindex, nofollow, noarchive, nosnippet, noimageindex">

<!-- Prevent social media crawling -->
<meta property="og:title" content="">
<meta property="og:description" content="">
<meta property="og:image" content="">
<meta name="twitter:card" content="">
<meta name="twitter:title" content="">
<meta name="twitter:description" content="">

<link href="https://fonts.googleapis.com/css2?family=Caveat:wght@500&family=Playfair+Display&display=swap" rel="stylesheet">

<!-- EmailJS -->
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>

<style>

body {
    margin: 0;
    background: #d8cfc4; /* desk color */
    font-family: 'Playfair Display', serif;
    padding: 20px 0;   /* Mobile-first: smaller padding */
}

@media (min-width: 481px) {
    body {
        padding: 40px 0;
    }
}

@media (min-width: 769px) {
    body {
        padding: 80px 0;
    }
}

/* Center wrapper */
.wrapper {
    display: flex;
    justify-content: center;
}

/* Diary */
.diary {
    width: 100%;
    max-width: 95%;
    background: #fdfaf3;
    padding: 30px 20px 30px 40px; /* Mobile-first: smaller padding */
    border-radius: 6px;
    box-shadow: 
        0 10px 30px rgba(0,0,0,0.2),
        inset 0 0 20px rgba(0,0,0,0.05);
    position: relative;
}

@media (min-width: 481px) {
    .diary {
        max-width: 90%;
        padding: 40px 40px 40px 60px;
        box-shadow: 
            0 15px 45px rgba(0,0,0,0.22),
            inset 0 0 25px rgba(0,0,0,0.05);
    }
}

@media (min-width: 769px) {
    .diary {
        width: 600px;
        max-width: 90%;
        padding: 60px 60px 60px 90px;
        box-shadow: 
            0 20px 60px rgba(0,0,0,0.25),
            inset 0 0 30px rgba(0,0,0,0.05);
    }
}

/* Red margin line */
.diary::before {
    content: "";
    position: absolute;
    left: 20px; /* Mobile-first: closer to edge */
    top: 0;
    bottom: 0;
    width: 3px; /* Mobile-first: thinner line */
    background: #c0392b;
    opacity: 0.5;
}

@media (min-width: 481px) {
    .diary::before {
        left: 30px;
        width: 3px;
    }
}

@media (min-width: 769px) {
    .diary::before {
        left: 40px;
        width: 4px;
    }
}

/* Notebook lines */
.diary::after {
    content: "";
    position: absolute;
    left: 0;
    right: 0;
    top: 0;
    bottom: 0;
    background: repeating-linear-gradient(
        to bottom,
        transparent,
        transparent 32px,
        rgba(0,0,0,0.05) 33px
    );
    pointer-events: none;
}

.letter {
    position: relative;
    font-size: 20px; /* Increased for better mobile readability */
    line-height: 1.7; /* Better line spacing for mobile */
    color: #2e2e2e;
    font-family: 'Caveat', cursive;
    opacity: 0;
    transform: translateY(30px);
    transition: all 1.5s ease;
}

@media (min-width: 481px) {
    .letter {
        font-size: 22px;
        line-height: 1.75;
    }
}

@media (min-width: 769px) {
    .letter {
        font-size: 24px;
        line-height: 1.8;
    }
}

.letter strong {
    font-size: 24px; /* Increased for mobile readability */
}

@media (min-width: 481px) {
    .letter strong {
        font-size: 26px;
    }
}

@media (min-width: 769px) {
    .letter strong {
        font-size: 30px;
    }
}

.signature {
    margin-top: 30px; /* Mobile-first: less margin */
    text-align: right;
    font-size: 22px; /* Increased for mobile readability */
}

@media (min-width: 481px) {
    .signature {
        margin-top: 40px;
        font-size: 26px;
    }
}

@media (min-width: 769px) {
    .signature {
        margin-top: 50px;
        font-size: 30px;
    }
}

.navigation {
    margin-top: 40px;
    text-align: center;
}

.back-btn {
    background: #c0392b;
    color: white;
    border: none;
    padding: 10px 20px; /* Mobile-first: smaller padding */
    border-radius: 20px; /* Mobile-first: smaller radius */
    font-family: 'Playfair Display', serif;
    font-size: 14px; /* Mobile-first: smaller font */
    cursor: pointer;
    transition: all 0.3s ease;
    box-shadow: 0 3px 10px rgba(192, 57, 43, 0.3);
}

@media (min-width: 481px) {
    .back-btn {
        padding: 11px 22px;
        border-radius: 22px;
        font-size: 15px;
        box-shadow: 0 3px 12px rgba(192, 57, 43, 0.3);
    }
}

@media (min-width: 769px) {
    .back-btn {
        padding: 12px 25px;
        border-radius: 25px;
        font-size: 16px;
        box-shadow: 0 4px 15px rgba(192, 57, 43, 0.3);
    }
}

.back-btn:hover {
    background: #a93226;
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(192, 57, 43, 0.4);
}

/* Realistic typewriter cursor */
.cursor {
    display: inline-block;
    background-color: #2e2e2e;
    width: 2px;
    height: 1.2em;
    margin-left: 1px;
    animation: blink 1.2s infinite;
    vertical-align: baseline;
}

@keyframes blink {
    0%, 45% { opacity: 1; }
    46%, 100% { opacity: 0; }

/* Hide cursor when typing is done */
.cursor.hidden {
    display: none;
}

/* Ensure proper line breaks in typewriter */
#typewriter-content {
    white-space: pre-wrap;
}

/* Mobile */
@media (max-width: 600px) {
    body {
        padding: 50px 0;
    }

    .diary {
        padding: 50px 30px 50px 70px;
    }

    .letter {
        font-size: 18px;
    }
}

</style>
</head>
<body>

<div class="wrapper">
    <div class="diary">
        <div class="letter" id="letter">
            <div id="typewriter-content"><span class="cursor" id="cursor"></span></div>
        </div>
        
        <div class="navigation" id="navigation" style="display: none;">
            <button class="back-btn" onclick="sendLetterNotification('BACK_CLICKED'); window.location.href='index.html'">‚Üê Back</button>
        </div>
    </div>
</div>

<script>
// Letter content structured as HTML for proper formatting
const letterParts = [
    { type: 'greeting', content: 'Salnaa,' },
    { type: 'break', content: '\n\n' },
    { type: 'paragraph', content: 'Edo‚Ä¶ annu enikk thett pattiyirunnu. \nNjan thante side ninn chinthichilla‚Ä¶ ente side maathram aanu njan chinthichath. ' },
    { type: 'break', content: '\n\n' },
    { type: 'paragraph', content: 'Athu ente thett aanu. ' },
    { type: 'break', content: '\n\n' },
    { type: 'paragraph', content: 'Ennod kshamikko‚Ä¶' },
    { type: 'break', content: '\n\n' },
    { type: 'paragraph', content: 'thanne... hurt cheyyan njan uddeshichittilla. \nPakshe njan paranja chila vaakukal ninne vedanippichittundengil‚Ä¶ athinu njan sincerely sorry. ' },
    { type: 'break', content: '\n\n' },
    { type: 'paragraph', content: 'Thaanne... enikk kaaryamaayirunnu. \nAth kondaan njan over aayi poyath. \nPakshe ath oru reason alla. ' },
    { type: 'break', content: '\n\n' },
    { type: 'paragraph', content: 'Ippo njan manasilakkunnu\nRespect um patience um aanu important enn. ' },
    { type: 'break', content: '\n\n' },
    { type: 'paragraph', content: 'Ninte space njan respect cheyyunnu. \nAthupole thante decision um. ' },
    { type: 'break', content: '\n\n' },
    { type: 'paragraph', content: 'Ninne impress cheyyan vendi alla ithokke parayunnath‚Ä¶\nEnikk thett pattiyennu manasilayi, athu clarify cheyyanam enn thonni. ' },
    { type: 'break', content: '\n\n' },
    { type: 'paragraph', content: 'Enthokke aayalum, thaan happy aayi irikk. \nAthreyum parayanam enn thonni. ' },
    { type: 'break', content: '\n\n' },
    { type: 'signature', content: '‚Äî Akhil ‚ù§Ô∏è' }
];

class HumanTypewriter {
    constructor(element, letterParts, options = {}) {
        this.element = element;
        this.letterParts = letterParts;
        this.cursor = document.getElementById('cursor');
        
        // Faster, smoother typing options
        this.options = {
            minSpeed: 15,     // Minimum typing speed (ms) - much faster
            maxSpeed: 60,     // Maximum typing speed (ms) - much faster
            pauseOnPunctuation: 150, // Shorter pause after punctuation
            pauseOnNewline: 400,     // Shorter pause after line breaks
            mistakeChance: 0.015,    // Slightly less mistakes for smoother flow
            correctionDelay: 250,    // Faster correction
            wordPause: 30,           // Small pause between words
            ...options
        };
        
        this.currentPartIndex = 0;
        this.currentCharIndex = 0;
        this.isTyping = false;
        this.currentElement = null;
    }
    
    // Get random typing speed with physics-based variation
    getRandomSpeed() {
        // Use a more natural distribution (weighted towards faster typing)
        const baseSpeed = Math.random() * (this.options.maxSpeed - this.options.minSpeed) + this.options.minSpeed;
        
        // Add some physics-based momentum (sometimes faster bursts, sometimes slower)
        const momentum = Math.random() < 0.3 ? 0.7 : 1.2; // 30% chance of slower, 70% faster
        
        return Math.max(this.options.minSpeed, baseSpeed * momentum);
    }
    
    // Simulate typing mistakes
    shouldMakeMistake() {
        return Math.random() < this.options.mistakeChance;
    }
    
    // Get a random wrong character
    getWrongChar() {
        const wrongChars = 'abcdefghijklmnopqrstuvwxyz';
        return wrongChars[Math.floor(Math.random() * wrongChars.length)];
    }
    
    async type() {
        if (this.isTyping) return;
        this.isTyping = true;
        
        // Show the letter container with fade-in
        const letter = document.getElementById("letter");
        letter.style.opacity = "1";
        letter.style.transform = "translateY(0)";
        
        for (let partIndex = 0; partIndex < this.letterParts.length; partIndex++) {
            const part = this.letterParts[partIndex];
            
            // Create appropriate element for each part
            if (part.type === 'greeting') {
                this.currentElement = document.createElement('p');
                this.currentElement.innerHTML = '<strong></strong>';
                this.currentElement = this.currentElement.querySelector('strong');
            } else if (part.type === 'paragraph') {
                this.currentElement = document.createElement('p');
            } else if (part.type === 'signature') {
                this.currentElement = document.createElement('p');
                this.currentElement.className = 'signature';
            } else if (part.type === 'signature-line2') {
                // Add line break and continue with same signature element
                if (this.currentElement) {
                    this.currentElement.innerHTML += '<br>';
                }
                // Don't create a new element, just continue with existing signature element
            } else if (part.type === 'break') {
                // Just add the breaks without creating elements
                continue;
            }
            
            // Insert element before cursor (but not for signature-line2 since we're reusing the element)
            if (part.type !== 'signature-line2') {
                this.element.insertBefore(this.currentElement.parentElement || this.currentElement, this.cursor);
            }
            
            // Add pause before typing signature line 2
            if (part.type === 'signature-line2') {
                await this.wait(this.options.pauseOnNewline * 0.6);
            }
            
            // Type each character in this part
            for (let charIndex = 0; charIndex < part.content.length; charIndex++) {
                const char = part.content[charIndex];
                
                // Handle line breaks within paragraphs
                if (char === '\n') {
                    this.currentElement.innerHTML += '<br>';
                    await this.wait(this.options.pauseOnNewline * 0.6); // Faster line breaks
                    continue;
                }
                
                // Simulate typing mistake occasionally (less frequent for smoother flow)
                if (this.shouldMakeMistake() && char.match(/[a-zA-Z]/) && Math.random() < 0.5) {
                    // Type wrong character
                    const wrongChar = this.getWrongChar();
                    this.currentElement.textContent += wrongChar;
                    
                    await this.wait(this.options.correctionDelay);
                    
                    // Backspace (delete wrong character)
                    this.currentElement.textContent = this.currentElement.textContent.slice(0, -1);
                    await this.wait(50); // Faster backspace
                }
                
                // Type the correct character
                this.currentElement.textContent += char;
                
                // Calculate pause with smoother physics
                let pause = this.getRandomSpeed();
                
                // Adjust timing based on character context
                if (char.match(/[.!?]/)) {
                    pause += this.options.pauseOnPunctuation;
                    
                    // Add extra space after full stops for better readability
                    if (char === '.' && charIndex < part.content.length - 1) {
                        const nextChar = part.content[charIndex + 1];
                        if (nextChar === ' ') {
                            pause += 100; // Extra pause after period before space
                        }
                    }
                } else if (char === ',') {
                    pause += 80; // Reduced comma pause
                } else if (char === ' ') {
                    pause += this.options.wordPause; // Consistent word spacing
                } else if (char.match(/[aeiouAEIOU]/)) {
                    pause *= 0.9; // Vowels type slightly faster
                } else if (char.match(/[bcdfghjklmnpqrstvwxyzBCDFGHJKLMNPQRSTVWXYZ]/)) {
                    pause *= 1.1; // Consonants slightly slower
                }
                
                await this.wait(pause);
            }
            
            // Shorter, more natural pause between paragraphs
            if (part.type === 'paragraph' || part.type === 'greeting') {
                await this.wait(this.options.pauseOnNewline * 0.8); // 20% faster paragraph breaks
            }
        }
        
        // Hide cursor when done and show back button
        this.cursor.classList.add('hidden');
        
        // Show the back button after typing is complete
        setTimeout(() => {
            const navigation = document.getElementById('navigation');
            navigation.style.display = 'block';
            navigation.style.opacity = '0';
            navigation.style.transition = 'opacity 0.5s ease';
            setTimeout(() => {
                navigation.style.opacity = '1';
            }, 100);
        }, 500);
        
        this.isTyping = false;
    }
    
    wait(ms) {
        return new Promise(resolve => setTimeout(resolve, ms));
    }
}

// Initialize EmailJS for letter page
(function() {
    emailjs.init("PwB4Z7ki5-x-eCbnI");
})();

// Function to send notification from letter page
function sendLetterNotification(action) {
    // Only send if EmailJS is available
    if (typeof emailjs === 'undefined') {
        console.log('EmailJS not loaded, skipping notification');
        return;
    }
    
    try {
        const now = new Date();
        const actionData = {
            'LETTER_OPENED': {
                title: 'Letter Page Opened üíï',
                message: 'Salna has opened the letter page and the typewriter animation has started! She\'s reading your words as they appear... ‚ú®'
            },
            'BACK_CLICKED': {
                title: 'Back Button Clicked ‚Üê',
                message: 'Salna clicked the back button from the letter page. She might be going back to think about it... ü§î'
            }
        };
        
        const data = actionData[action];
        const templateParams = {
            action: data.title,
            timestamp: now.toLocaleString('en-IN', { 
                timeZone: 'Asia/Kolkata',
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            }),
            message: data.message
        };

        emailjs.send('service_lp0tn1o', 'template_07g3t0c', templateParams)
            .then(function(response) {
                console.log('‚úÖ Letter notification sent!', response.status);
            }, function(error) {
                console.log('‚ùå Failed to send letter notification:', error);
            });
    } catch (error) {
        console.log('‚ùå Error in sendLetterNotification:', error);
    }
}

// Start typing when page loads
window.addEventListener("load", () => {
    // Initialize the typewriter first (most important)
    const typewriterElement = document.getElementById("typewriter-content");
    const typewriter = new HumanTypewriter(typewriterElement, letterParts);
    
    // Start typing after a shorter delay
    setTimeout(() => {
        typewriter.type();
    }, 500);
    
    // Send notification after a delay to ensure EmailJS is loaded
    setTimeout(() => {
        sendLetterNotification('LETTER_OPENED');
    }, 1000);
});
</script>

</body>
</html>
